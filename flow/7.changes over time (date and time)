===============================================================================
ðŸ“… CHANGE OVER TIME ANALYSIS (Extended)
===============================================================================
Purpose:
    - To analyze business performance across different time periods
    - To identify monthly, quarterly, and yearly trends
    - To calculate growth, seasonality, and peak periods
===============================================================================
*/

--  Sales Trend by Quarter
SELECT
    YEAR(order_date) AS order_year,
    QUARTER(order_date) AS order_quarter,
    SUM(sales_amount) AS total_sales,
    COUNT(DISTINCT customer_key) AS total_customers,
    SUM(quantity) AS total_quantity
FROM fact_sales
WHERE order_date IS NOT NULL
GROUP BY YEAR(order_date), QUARTER(order_date)
ORDER BY order_year, order_quarter;


--  Sales Trend by Week of the Year
SELECT
    YEAR(order_date) AS order_year,
    WEEK(order_date) AS order_week,
    SUM(sales_amount) AS total_sales,
    COUNT(DISTINCT customer_key) AS total_customers
FROM fact_sales
WHERE order_date IS NOT NULL
GROUP BY 1, 2
ORDER BY 1,2;


--  Sales Performance by Day of the Week (to see which day drives most sales)
SELECT
    DAYNAME(order_date) AS day_name,
    SUM(sales_amount) AS total_sales,
    AVG(sales_amount) AS avg_sales,
    COUNT(order_number) AS total_orders
FROM fact_sales
WHERE order_date IS NOT NULL
GROUP BY DAYNAME(order_date)
ORDER BY total_sales DESC;


--  Sales by Month Across All Years (to identify seasonality)
SELECT
    MONTHNAME(order_date) AS month_name,
    SUM(sales_amount) AS total_sales,
    ROUND(AVG(sales_amount), 2) AS avg_sales_per_month
FROM fact_sales
WHERE order_date IS NOT NULL
GROUP BY MONTHNAME(order_date), MONTH(order_date)
ORDER BY MONTH(order_date);


--  Average Order Value (AOV) Over Time
SELECT
    YEAR(order_date) AS order_year,
    ROUND(SUM(sales_amount) / COUNT(DISTINCT order_number), 2) AS avg_order_value
FROM fact_sales
WHERE order_date IS NOT NULL
GROUP BY YEAR(order_date)
ORDER BY order_year;



-- Monthly Sales Cumulative Total (Running Total)
SELECT
    YEAR(order_date) AS order_year,
    MONTH(order_date) AS order_month,
    SUM(sales_amount) AS monthly_sales,
    SUM(SUM(sales_amount)) OVER (ORDER BY YEAR(order_date), MONTH(order_date)) AS cumulative_sales
FROM fact_sales
WHERE order_date IS NOT NULL
GROUP BY YEAR(order_date), MONTH(order_date)
ORDER BY order_year, order_month;


-- Peak Day Detection (Highest Sales Day)
SELECT
    order_date,
    SUM(sales_amount) AS total_sales
FROM fact_sales
WHERE order_date IS NOT NULL
GROUP BY order_date
ORDER BY total_sales DESC
LIMIT 5;
